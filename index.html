<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BAYC NFT Wrapper</title>
  <!-- Load ethers.js from CDN -->
  <script src="https://unpkg.com/ethers/dist/ethers.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    input, button { padding: 8px; margin: 5px; }
    #explanation { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
  </style>
</head>
<body>
  <h1>BAYC NFT Wrapper Interface</h1>
  <div id="wallet-connection">
    <button id="connectWallet">Connect Wallet</button>
    <p id="accountDisplay"></p>
  </div>
  <div id="wrapperInterface" style="display: none;">
    <h2>Wrap / Unwrap Your NFT</h2>
    <div>
      <label>Token ID:</label>
      <input type="number" id="tokenId" placeholder="Enter your NFT Token ID" />
    </div>
    <div>
      <label>Time Lock Duration (seconds):</label>
      <input type="number" id="timeLock" placeholder="e.g., 604800 for 7 days" />
    </div>
    <div>
      <button id="wrapButton">Wrap NFT</button>
      <button id="unwrapButton">Unwrap NFT</button>
    </div>
    <p id="status"></p>
  </div>

  <div id="explanation">
    <h3>How It Works</h3>
    <p>
      <strong>Wrapping:</strong> When you wrap your NFT, the contract transfers your BAYC NFT into custody and mints you 1 fungible token (1e18 units). You must specify a time lock durationâ€”this sets a period during which the NFT is locked in the contract.
    </p>
    <p>
      <strong>Unwrapping:</strong> Before the time lock expires, you can call the unwrap function to get your NFT back. When unwrapped, the NFT is transferred back to you and the fungible token is burned.
    </p>
    <p>
      The time lock is designed as a security measure, ensuring that the NFT remains in the contract for the specified duration.
    </p>
  </div>

  <script>
    // Replace with your deployed NFTWrapper contract address
    const contractAddress = "0x3F4c45e4B6E83f6EA23f783f5F11603BC00B9122"; 

    // Minimal ABI containing only the functions we need
    const contractABI = [
      "function wrapNFT(uint256 tokenId, uint256 timeLockDuration) external",
      "function unwrapNFT(uint256 tokenId) external"
    ];

    let provider, signer, contract;

    document.getElementById("connectWallet").onclick = async function () {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        const account = await signer.getAddress();
        document.getElementById("accountDisplay").innerText = "Connected: " + account;
        contract = new ethers.Contract(contractAddress, contractABI, signer);
        document.getElementById("wrapperInterface").style.display = "block";
      } else {
        alert("Please install MetaMask!");
      }
    };

    document.getElementById("wrapButton").onclick = async function () {
      const tokenId = document.getElementById("tokenId").value;
      const timeLock = document.getElementById("timeLock").value;
      if (!tokenId || !timeLock) {
        alert("Please enter both a token ID and time lock duration.");
        return;
      }
      document.getElementById("status").innerText = "Wrapping NFT...";
      try {
        const tx = await contract.wrapNFT(tokenId, timeLock);
        await tx.wait();
        document.getElementById("status").innerText = "NFT wrapped successfully!";
      } catch (error) {
        console.error(error);
        document.getElementById("status").innerText = "Error wrapping NFT: " + error.message;
      }
    };

    document.getElementById("unwrapButton").onclick = async function () {
      const tokenId = document.getElementById("tokenId").value;
      if (!tokenId) {
        alert("Please enter the token ID.");
        return;
      }
      document.getElementById("status").innerText = "Unwrapping NFT...";
      try {
        const tx = await contract.unwrapNFT(tokenId);
        await tx.wait();
        document.getElementById("status").innerText = "NFT unwrapped successfully!";
      } catch (error) {
        console.error(error);
        document.getElementById("status").innerText = "Error unwrapping NFT: " + error.message;
      }
    };
  </script>
</body>
</html>
